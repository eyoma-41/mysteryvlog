<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>미스터리 브이로그 — 수익창출</title>
  <style>
    :root{
      --bg:#0f0f0f;--panel:#1a1a1a;--text:#e6e6e6;--muted:#a1a1aa;--border:#303030;--brand:#ff0033;
      --positive:#22c55e;--warn:#f59e0b;--accent:#3b82f6;--r:14px;--shadow:0 2px 10px rgba(0,0,0,.25)
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#f7f8fa;--panel:#ffffff;--text:#101114;--muted:#6b7280;--border:#e6e8eb;--shadow:0 1px 6px rgba(0,0,0,.08)}
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Pretendard,system-ui,"Noto Sans KR",sans-serif}
    .wrap{max-width:1000px;margin:0 auto;padding:16px 16px 96px}

    /* 헤더 */
    .header{display:flex;align-items:center;justify-content:space-between;margin:4px 0 12px}
    .title{display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
    h1{margin:0;font-size:22px;letter-spacing:-.2px}
    .sub{font-size:12px;color:var(--muted)}

    /* 바/패널 공통 */
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow)}
    .row{display:grid;grid-template-columns: 1fr;gap:12px}
    @media (min-width:900px){ .row{grid-template-columns: 1.2fr .8fr} }

    /* 메트릭 카드 */
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:6px}
    @media (min-width:700px){ .cards{grid-template-columns:repeat(4,1fr)} }
    .card{padding:14px;border:1px solid var(--border);border-radius:12px;background:transparent}
    .label{font-size:12px;color:var(--muted)}
    .metric{display:flex;align-items:flex-end;gap:8px;margin-top:6px}
    .value{font-weight:800;font-size:22px;letter-spacing:-.3px}
    .delta{font-size:12px}
    .delta.up{color:var(--positive)} .delta.down{color:#ef4444}

    /* 차트 */
    .chart{padding:12px}
    .chart h3{margin:0 0 8px 0;font-size:14px}
    .svgwrap{width:100%;height:120px}
    .legend{display:flex;gap:10px;margin:6px 2px 2px}
    .legend .dot{width:8px;height:8px}
    .sep{height:1px;background:var(--border);margin:8px 0}

    /* 링크 리스트 */
    .links{padding:8px}
    .links h3{margin:0 0 8px 0;font-size:14px}
    .item{display:grid;grid-template-columns: auto 1fr auto;gap:10px;align-items:center;padding:10px;border-bottom:1px solid var(--border)}
    .badge{width:28px;height:28px;border-radius:8px;background:#1113;display:grid;place-items:center;font-weight:800}
    @media (prefers-color-scheme: light){ .badge{background:#f3f4f6} }
    .meta{display:grid;gap:2px}
    .name{font-weight:700}
    .muted{color:var(--muted);font-size:12px}
    .actions{display:flex;gap:6px}
    .btn{height:32px;padding:0 10px;border:1px solid var(--border);border-radius:8px;background:transparent;color:var(--text);font-size:12px;cursor:pointer}
    .btn.primary{border-color:#334155;background:#33415522}
    .btn:active{transform:translateY(1px)}
    .bar{height:6px;background:#1112;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    @media (prefers-color-scheme: light){ .bar{background:#f1f5f9} }
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#60a5fa)}

    /* 토스트 */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:88px;background:#111318;color:#fff;
      padding:10px 14px;border-radius:12px;font-size:13px;opacity:0;pointer-events:none;transition:opacity .2s}
    .toast.show{opacity:1}

    /* 하단 탭 (유지) */
    .tabs{position:fixed;left:0;right:0;bottom:0;background:var(--panel);border-top:1px solid var(--border);
      display:grid;grid-template-columns:repeat(5,1fr);height:72px}
    .tab{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;font-size:12px;color:var(--muted);text-decoration:none}
    .tab svg{width:22px;height:22px}
    .tab.active{color:var(--brand);font-weight:800}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <span class="dot" aria-hidden="true"></span>
        <div>
          <h1>수익창출</h1>
          <div class="sub">《미스터리 브이로그》 구매는 작가에게 큰 힘이 됩니다.</div>
        </div>
      </div>
      <div class="sub" id="lastSync">최근 동기화: -</div>
    </div>

    <!-- 상단 메트릭 -->
    <div class="cards panel">
      <div class="card">
        <div class="label">총 클릭</div>
        <div class="metric"><div class="value" id="mClicks">0</div><div class="delta up" id="mClicksDelta">+0%</div></div>
      </div>
      <div class="card">
        <div class="label">고유 방문</div>
        <div class="metric"><div class="value" id="mUnique">0</div><div class="delta up" id="mUniqueDelta">+0%</div></div>
      </div>
      <div class="card">
        <div class="label">추정 전환</div>
        <div class="metric"><div class="value" id="mConv">0</div><div class="delta down" id="mConvDelta">0%</div></div>
      </div>
      <div class="card">
        <div class="label">활성 링크</div>
        <div class="metric"><div class="value" id="mActive">4</div><div class="delta up">OK</div></div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <!-- 좌: 트래픽/스파크라인 -->
      <section class="panel chart">
        <h3>최근 7일 클릭 추이</h3>
        <div class="svgwrap">
          <svg id="spark" viewBox="0 0 300 100" preserveAspectRatio="none" width="100%" height="100%" aria-label="최근 7일 트래픽 스파크라인">
            <polyline id="poly" fill="none" stroke="currentColor" stroke-width="2" opacity=".9"></polyline>
          </svg>
        </div>
        <div class="legend">
          <span class="dot" style="background:var(--accent)"></span><span class="muted">클릭수</span>
        </div>
        <div class="sep"></div>
        <div class="sub">Tip: 리플레이 북 + 비하인드 북과 함께 읽으면 2배로 재미있습니다.</div>
      </section>

      <!-- 우: 링크 리스트 -->
      <section class="panel links">
        <h3>링크 성과</h3>

        <!-- 알라딘 -->
        <div class="item" data-key="aladin" data-url="https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=362773341">
          <div class="badge">A</div>
          <div class="meta">
            <div class="name">알라딘</div>
            <div class="muted"><span data-count="aladin">0</span> 클릭 · 최근 <span data-last="aladin">-</span></div>
            <div class="bar"><span data-bar="aladin" style="width:0%"></span></div>
          </div>
          <div class="actions">
            <button class="btn primary" data-open="aladin" aria-label="알라딘 열기">열기</button>
            <button class="btn" data-copy="aladin" aria-label="알라딘 링크 복사">복사</button>
          </div>
        </div>

        <!-- YES24 -->
        <div class="item" data-key="yes24" data-url="https://www.yes24.com/product/goods/145579009">
          <div class="badge">Y</div>
          <div class="meta">
            <div class="name">YES24</div>
            <div class="muted"><span data-count="yes24">0</span> 클릭 · 최근 <span data-last="yes24">-</span></div>
            <div class="bar"><span data-bar="yes24" style="width:0%"></span></div>
          </div>
          <div class="actions">
            <button class="btn primary" data-open="yes24" aria-label="YES24 열기">열기</button>
            <button class="btn" data-copy="yes24" aria-label="YES24 링크 복사">복사</button>
          </div>
        </div>

        <!-- 교보문고 -->
        <div class="item" data-key="kyobo" data-url="https://product.kyobobook.co.kr/detail/S000216345280">
          <div class="badge">K</div>
          <div class="meta">
            <div class="name">교보문고</div>
            <div class="muted"><span data-count="kyobo">0</span> 클릭 · 최근 <span data-last="kyobo">-</span></div>
            <div class="bar"><span data-bar="kyobo" style="width:0%"></span></div>
          </div>
          <div class="actions">
            <button class="btn primary" data-open="kyobo" aria-label="교보문고 열기">열기</button>
            <button class="btn" data-copy="kyobo" aria-label="교보문고 링크 복사">복사</button>
          </div>
        </div>

        <!-- 쿠팡 -->
        <div class="item" data-key="coupang" data-url="https://link.coupang.com/a/cY8u44">
          <div class="badge">C</div>
          <div class="meta">
            <div class="name">쿠팡</div>
            <div class="muted"><span data-count="coupang">0</span> 클릭 · 최근 <span data-last="coupang">-</span></div>
            <div class="bar"><span data-bar="coupang" style="width:0%"></span></div>
          </div>
          <div class="actions">
            <button class="btn primary" data-open="coupang" aria-label="쿠팡 열기">열기</button>
            <button class="btn" data-copy="coupang" aria-label="쿠팡 링크 복사">복사</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- 토스트 -->
  <div class="toast" id="toast" role="status" aria-live="polite">복사됨!</div>

  <!-- 하단 고정 탭 (유지) -->
  <nav class="tabs" aria-label="하단 메뉴">
    <a class="tab" href="index.html" aria-label="대시보드로 이동"><svg viewBox="0 0 24 24"><path d="M4 12.5a1 1 0 0 1 .4-.8l7-5a1 1 0 0 1 1.2 0l7 5a1 1 0 0 1 .4.8V19a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-6.5Z" fill="currentColor"/></svg>대시보드</a>
    <a class="tab" href="meme.html" aria-label="밈으로 이동"><svg viewBox="0 0 24 24"><path d="M3 7h18M7 3v18M3 12h18M3 17h12" stroke="currentColor" stroke-width="2" fill="none"/></svg>밈</a>
    <a class="tab" href="reference.html" aria-label="레퍼런스로 이동"><svg viewBox="0 0 24 24"><path d="M5 4h14v16H5zM8 8h8M8 12h8M8 16h8" stroke="currentColor" stroke-width="2" fill="none"/></svg>레퍼런스</a>
    <a class="tab" href="behind.html" aria-label="비하인드로 이동"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" fill="none"/></svg>비하인드</a>
    <a class="tab active" href="revenue.html" aria-current="page" aria-label="수익창출 현재 페이지"><svg viewBox="0 0 24 24"><path d="M4 18s3-6 8-6 8 6 8 6M10 9a2 2 0 1 0 4 0 2 2 0 0 0-4 0Z" stroke="currentColor" stroke-width="2" fill="none"/></svg>수익창출</a>
  </nav>

  <script>
    // ====== 데이터/유틸 ======
    const keys = ['aladin','yes24','kyobo','coupang'];
    const lsKey = (k)=>`revstat:${k}`;
    const pad=(n)=>String(n).padStart(2,'0');
    const fmt=(ts)=> ts ? `${new Date(ts).getFullYear()}.${pad(new Date(ts).getMonth()+1)}.${pad(new Date(ts).getDate())}` : '-';

    // 7일 트래픽(로컬 보관). 없으면 기동 시 생성
    function seed7d(){
      let data = JSON.parse(localStorage.getItem('revstat:7d')||'null');
      if(!data){
        data = Array.from({length:7},()=>Math.floor(Math.random()*6)+1);
        localStorage.setItem('revstat:7d', JSON.stringify(data));
      }
      return data;
    }
    function pushTodayHit(){
      // 하루에 여러 번 열어도 누적(간단 모형)
      const d = seed7d();
      d[d.length-1] = (d[d.length-1]||0)+1;
      localStorage.setItem('revstat:7d', JSON.stringify(d));
    }

    // ====== 스파크라인 ======
    function drawSpark(){
      const svg = document.getElementById('spark');
      const poly = document.getElementById('poly');
      const data = seed7d();
      const max = Math.max(1, ...data);
      const step = 300/(data.length-1);
      const pts = data.map((v,i)=>{
        const x = i*step;
        const y = 100 - (v/max)*90 - 5; // 상하 여백
        return `${x},${y}`;
      }).join(' ');
      poly.setAttribute('points', pts);
    }

    // ====== 메트릭/리스트 ======
    function refreshList(){
      // 총합 및 막대 너비 계산
      let total = 0;
      const counts = {};
      keys.forEach(k=>{
        const c = Number(localStorage.getItem(lsKey(k)+':count')||0);
        counts[k] = c; total += c;
      });
      keys.forEach(k=>{
        const c = counts[k];
        const last = localStorage.getItem(lsKey(k)+':last');
        const bar = document.querySelector(`[data-bar="${k}"]`);
        const cnt = document.querySelector(`[data-count="${k}"]`);
        const lastSpan = document.querySelector(`[data-last="${k}"]`);
        if(cnt) cnt.textContent = c;
        if(lastSpan) lastSpan.textContent = last ? fmt(Number(last)) : '-';
        if(bar){
          const ratio = total ? Math.round((c/total)*100) : 0;
          bar.style.width = ratio + '%';
        }
      });

      // 상단 메트릭(거칠게)
      document.getElementById('mClicks').textContent = total;
      document.getElementById('mUnique').textContent = Math.max(1, Math.round(total*0.8));
      document.getElementById('mConv').textContent = Math.round(total*0.05);
      document.getElementById('mClicksDelta').textContent = total ? '+12%' : '0%';
      document.getElementById('mUniqueDelta').textContent = total ? '+9%' : '0%';
      document.getElementById('mConvDelta').textContent = total ? '+3%' : '0%';
      document.getElementById('lastSync').textContent = '최근 동기화: ' + fmt(Date.now());
    }

    // ====== 동작 ======
    function openKey(key){
      const el = document.querySelector(`.item[data-key="${key}"]`);
      if(!el) return;
      const url = el.dataset.url;
      // 통계 반영
      const cKey = lsKey(key)+':count';
      const lKey = lsKey(key)+':last';
      const next = Number(localStorage.getItem(cKey)||0)+1;
      localStorage.setItem(cKey, String(next));
      localStorage.setItem(lKey, String(Date.now()));
      pushTodayHit();
      refreshList(); drawSpark();
      window.open(url,'_blank','noopener');
    }
    async function copyKey(key){
      const el = document.querySelector(`.item[data-key="${key}"]`);
      if(!el) return;
      const url = el.dataset.url;
      try{
        await navigator.clipboard.writeText(url);
        toast('링크가 복사되었습니다');
      }catch{
        const ta=document.createElement('textarea'); ta.value=url; document.body.appendChild(ta);
        ta.select(); document.execCommand('copy'); ta.remove();
        toast('링크가 복사되었습니다');
      }
    }

    // 이벤트 바인딩
    document.querySelectorAll('[data-open]').forEach(b=>{
      b.addEventListener('click',()=>openKey(b.getAttribute('data-open')));
    });
    document.querySelectorAll('[data-copy]').forEach(b=>{
      b.addEventListener('click',()=>copyKey(b.getAttribute('data-copy')));
    });

    // 단축키: 1~4 열기, C 복사(선택된 첫 항목)
    window.addEventListener('keydown',(e)=>{
      const map={'1':'aladin','2':'yes24','3':'kyobo','4':'coupang'};
      if(map[e.key]){ openKey(map[e.key]); }
      if(e.key==='c' || e.key==='C'){ copyKey('aladin'); } // 기본 복사 대상을 알라딘으로
    });

    // 토스트
    const toastEl = document.getElementById('toast');
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(()=>toastEl.classList.remove('show'),1400);
    }

    // 초기화
    drawSpark();
    refreshList();
  </script>
</body>
</html>
