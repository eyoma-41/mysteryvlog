<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>미스터리 브이로그 — 레퍼런스</title>
  <style>
    :root{
      --border:#e6e8eb;--brand:#ff0033;--text:#111318;--muted:#6b7280;
      --bg:#fff;--shadow:0 10px 30px rgba(0,0,0,.18)
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Pretendard,system-ui,"Noto Sans KR",sans-serif;color:var(--text);background:var(--bg)}

    .wrap{max-width:1200px;margin:0 auto;padding:16px 16px 96px}
    h1{margin:8px 0 12px}
    .caption{font-size:13px;color:var(--muted);margin-bottom:12px}

    /* 카드 2열 큰 사이즈 */
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:24px}
    @media (min-width:680px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }

    .card{display:block;border:1px solid var(--border);border-radius:20px;background:#fff;text-decoration:none;color:inherit;overflow:hidden;transition:transform .2s}
    .card:hover{transform:translateY(-4px)}
    .thumb{aspect-ratio:16/9;background:#f3f4f6 center/cover no-repeat}
    .card-body{padding:16px}
    .card-title{font-weight:800;font-size:18px;line-height:1.4}
    .card-meta{margin-top:6px;font-size:13px;color:var(--muted)}

    .modal-desc strong{font-weight:800}
    .modal-desc .thin{font-weight:300;color:#6b7280}

    .tabs{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);display:grid;grid-template-columns:repeat(5,1fr);height:72px;z-index:40}
    .tab{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;font-size:12px;color:#333;text-decoration:none}
    .tab svg{width:22px;height:22px}
    .tab.active{color:var(--brand);font-weight:800}

    .backdrop{position:fixed;inset:0;background:rgba(17,19,24,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
    .backdrop.show{display:flex}

    .modal{width:min(1200px,100%);max-height:calc(100vh - 120px);background:#000;border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);overflow:hidden;display:grid;grid-template-rows:auto 1fr auto auto}
    .modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:#fff;border-bottom:1px solid var(--border)}
    .modal-title{font-weight:900;font-size:18px}
    .viewer{position:relative;background:#000;display:grid;place-items:center}
    .viewer img,.viewer iframe{max-width:100%;max-height:calc(100vh - 320px);object-fit:contain;background:#000}
    .nav-btn{position:absolute;top:50%;transform:translateY(-50%);border:none;background:rgba(255,255,255,.85);width:50px;height:50px;border-radius:50%;display:grid;place-items:center;cursor:pointer}
    .nav-btn:hover{background:#fff}
    .nav-prev{left:16px}
    .nav-next{right:16px}

    .thumbstrip{display:flex;gap:8px;overflow:auto;padding:8px 12px;background:#0b0b0b;border-top:1px solid rgba(255,255,255,.08)}
    .thumbstrip img{width:90px;height:60px;object-fit:cover;border:2px solid transparent;border-radius:6px;cursor:pointer;opacity:.8}
    .thumbstrip img.active{border-color:var(--brand);opacity:1}

    .modal-footer{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:14px 20px;background:#fff;border-top:1px solid var(--border)}
    .counter{font-size:14px;color:var(--muted)}
    .desc{font-size:15px;line-height:1.6}

    .close-x{border:none;background:transparent;cursor:pointer}
    .close-x svg{width:24px;height:24px}
      .video-cover{position:relative;display:grid;place-items:center;width:100%;}
    .video-cover img{max-width:100%;max-height:calc(100vh - 320px);object-fit:contain;background:#000}
    .play-btn{position:absolute;display:grid;place-items:center;width:86px;height:86px;border-radius:50%;border:none;cursor:pointer;background:rgba(255,255,255,.9);box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .play-btn svg{width:34px;height:34px;transform:translateX(2px)}
    .play-btn:hover{background:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>레퍼런스</h1>
    <div class="caption">카드 크기를 키워 2열로 배치했습니다. 이미지/영상 캐러셀 팝업 지원. strong / thin 텍스트 스타일 가능.</div>

    <div id="refGrid" class="grid">
      <!-- 예시 1: 단일 이미지 -->
      <a class="card" href="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme01.png"
         data-title="샘플 — 단일 이미지"
         data-text="<strong>단일 이미지</strong> <span class='thin'>얇은 텍스트 예시</span>"
         data-images="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme01.png">
        <div class="thumb" style="background-image:url('https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme01.png')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 단일 이미지</div>
          <div class="card-meta">Image</div>
        </div>
      </a>

      <!-- 예시 2: 여러 이미지 -->
      <a class="card" href="#"
         data-title="샘플 — 여러 이미지"
         data-text="<strong>여러 이미지</strong> <span class='thin'>캐러셀 예시</span>"
         data-images="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme02.png, https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme03.jpg, https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme04.jpg">
        <div class="thumb" style="background-image:url('https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme02.png')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 여러 이미지</div>
          <div class="card-meta">Image × 3</div>
        </div>
      </a>

      <!-- 예시 3: 단일 영상 -->
      <a class="card" href="https://www.youtube.com/watch?v=Dz_EkjVNWFU&t=55s"
         data-title="샘플 — 단일 영상"
         data-text="<strong>단일 영상</strong> <span class='thin'>유튜브 타임스탬프 지원</span>"
         data-videos="https://www.youtube.com/watch?v=Dz_EkjVNWFU&t=55s">
        <div class="thumb" style="background-image:url('https://img.youtube.com/vi/Dz_EkjVNWFU/hqdefault.jpg')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 단일 영상</div>
          <div class="card-meta">YouTube</div>
        </div>
      </a>
    </div>
  </div>

  <nav class="tabs" aria-label="하단 메뉴">
    <a class="tab" href="index.html"><svg viewBox="0 0 24 24"><path d="M4 12.5a1 1 0 0 1 .4-.8l7-5a1 1 0 0 1 1.2 0l7 5a1 1 0 0 1 .4.8V19a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-6.5Z" fill="currentColor"/></svg>대시보드</a>
    <a class="tab" href="meme.html"><svg viewBox="0 0 24 24"><path d="M3 7h18M7 3v18M3 12h18M3 17h12" stroke="currentColor" stroke-width="2" fill="none"/></svg>밈</a>
    <a class="tab active" href="reference.html" aria-current="page"><svg viewBox="0 0 24 24"><path d="M5 4h14v16H5zM8 8h8M8 12h8M8 16h8" stroke="currentColor" stroke-width="2" fill="none"/></svg>레퍼런스</a>
    <a class="tab" href="behind.html"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" fill="none"/></svg>비하인드</a>
    <a class="tab" href="revenue.html"><svg viewBox="0 0 24 24"><path d="M4 18s3-6 8-6 8 6 8 6M10 9a2 2 0 1 0 4 0 2 2 0 0 0-4 0Z" stroke="currentColor" stroke-width="2" fill="none"/></svg>수익창출</a>
  </nav>

  <!-- 모달 -->
  <div id="backdrop" class="backdrop" aria-hidden="true">
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div id="modalTitle" class="modal-title">제목</div>
        <button class="close-x" id="closeX" aria-label="닫기">
          <svg viewBox="0 0 24 24"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        </button>
      </div>
      <div class="viewer">
        <button class="nav-btn nav-prev" id="btnPrev" aria-label="이전">
          <svg viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        </button>
        <div id="viewerSlot"></div>
        <button class="nav-btn nav-next" id="btnNext" aria-label="다음">
          <svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        </button>
      </div>
      <div class="thumbstrip" id="thumbstrip" aria-label="썸네일"></div>
      <div class="modal-footer">
        <div class="counter" id="counter">1 / 1</div>
        <div class="desc modal-desc" id="modalDesc"></div>
      </div>
    </div>
  </div>

  <script>
    const grid=document.getElementById('refGrid');
    const backdrop=document.getElementById('backdrop');
    const modal=document.getElementById('modal');
    const viewerSlot=document.getElementById('viewerSlot');
    const modalTitle=document.getElementById('modalTitle');
    const modalDesc=document.getElementById('modalDesc');
    const counter=document.getElementById('counter');
    const thumbstrip=document.getElementById('thumbstrip');
    const btnPrev=document.getElementById('btnPrev');
    const btnNext=document.getElementById('btnNext');
    const closeX=document.getElementById('closeX');

    let slides=[];
    let idx=0;
    let currentIframe=null;

    function toYouTubeEmbed(url){
      try{
        const u=new URL(url);
        let start='';
        if(u.searchParams.has('t')){
          const t=u.searchParams.get('t').replace('s','');
          start=`?start=${parseInt(t)}`;
        }
        if(u.hostname.includes('youtube.com')){
          const v=u.searchParams.get('v');
          if(v) return {embed:`https://www.youtube.com/embed/${v}${start}`,id:v};
        }
        if(u.hostname.includes('youtu.be')){
          const id=u.pathname.slice(1);
          if(id) return {embed:`https://www.youtube.com/embed/${id}${start}`,id};
        }
      }catch(e){}
      return null;
    }
    function getYouTubeInfoFromEmbed(embed){
      // embed URL에서 id 추출 (…/embed/VIDEOID?…)
      try{
        const u=new URL(embed);
        const parts=u.pathname.split('/');
        const id=parts[parts.length-1];
        return {id:id.split('?')[0], embed};
      }catch(e){ return {id:'', embed}; }
    }

    function parseList(attr){return (attr||'').split(',').map(s=>s.trim()).filter(Boolean)}

    function parseSlides(a){
      const imgs=parseList(a.dataset.images);
      const vids=parseList(a.dataset.videos);
      const arr=[];
      imgs.forEach(src=>arr.push({type:'image',src,thumb:src}));
      vids.forEach(url=>{
        const yt=toYouTubeEmbed(url);
        if(yt){arr.push({type:'youtube',src:yt.embed,thumb:`https://img.youtube.com/vi/${yt.id}/hqdefault.jpg`})}
      });
      if(arr.length===0){
        const href=a.getAttribute('href');
        if(/\.(png|jpe?g|webp|gif|bmp|avif)(\?.*)?$/i.test(href||'')) arr.push({type:'image',src:href,thumb:href});
      }
      return arr;
    }

    function mount(type,src,title){
      viewerSlot.innerHTML='';
      currentIframe=null;
      if(type==='image'){
        const img=document.createElement('img');
        img.alt=title||'이미지';
        img.src=src;
        viewerSlot.appendChild(img);
      }else if(type==='youtube'){
        // 수동 재생: 썸네일 + 플레이 버튼 렌더링 후 클릭 시 iframe 주입
        const info = getYouTubeInfoFromEmbed(src);
        const cover=document.createElement('div');
        cover.className='video-cover';
        const thumb=document.createElement('img');
        thumb.alt=title||'동영상 썸네일';
        thumb.src=`https://img.youtube.com/vi/${info.id}/hqdefault.jpg`;
        const btn=document.createElement('button');
        btn.className='play-btn';
        btn.setAttribute('aria-label','영상 재생');
        btn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7-11-7z" fill="currentColor"/></svg>';
        function start(){
          const iframe=document.createElement('iframe');
          iframe.src = info.embed + (info.embed.includes('?') ? '&' : '?') + 'autoplay=1';
          iframe.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
          iframe.referrerPolicy='strict-origin-when-cross-origin';
          iframe.allowFullscreen=true;
          viewerSlot.innerHTML='';
          viewerSlot.appendChild(iframe);
          currentIframe=iframe;
        }
        cover.appendChild(thumb);
        cover.appendChild(btn);
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); start(); });
        // 썸네일 아무 곳 클릭해도 재생
        cover.addEventListener('click', (e)=>{ e.stopPropagation(); start(); });
        viewerSlot.appendChild(cover);
      }
    }

    function show(i){
      if(!slides.length) return;
      idx=(i+slides.length)%slides.length;
      const s=slides[idx];
      mount(s.type,s.src,modalTitle.textContent);
      counter.textContent=`${idx+1} / ${slides.length}`;
      [...thumbstrip.querySelectorAll('img')].forEach((el,n)=>el.classList.toggle('active',n===idx));
    }

    function buildThumbs(){
      thumbstrip.innerHTML='';
      slides.forEach((s,n)=>{
        const t=document.createElement('img');
        t.src=s.thumb; t.alt=`썸네일 ${n+1}`;
        t.addEventListener('click',e=>{e.stopPropagation();show(n)});
        thumbstrip.appendChild(t);
      });
    }

    function openModal(a){
      slides=parseSlides(a);
      modalTitle.textContent=a.dataset.title||a.querySelector('.card-title')?.textContent||'';
      modalDesc.innerHTML=a.dataset.text||'';
      buildThumbs();
      show(0);
      backdrop.classList.add('show');
      backdrop.setAttribute('aria-hidden','false');
    }

    function closeModal(){
      backdrop.classList.remove('show');
      backdrop.setAttribute('aria-hidden','true');
      if(currentIframe){currentIframe.src='about:blank';currentIframe=null}
    }

    grid.addEventListener('click',e=>{
      const a=e.target.closest('a.card');
      if(!a) return;
      e.preventDefault();
      openModal(a);
    });

    btnPrev.addEventListener('click',e=>{e.stopPropagation();show(idx-1)});
    btnNext.addEventListener('click',e=>{e.stopPropagation();show(idx+1)});
    closeX.addEventListener('click',e=>{e.stopPropagation();closeModal()});
