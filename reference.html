<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>미스터리 브이로그 — 레퍼런스</title>
  <style>
    :root{
      --border:#e6e8eb;--brand:#ff0033;--text:#111318;--muted:#6b7280;
      --bg:#fff;--shadow:0 10px 30px rgba(0,0,0,.18)
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Pretendard,system-ui,"Noto Sans KR",sans-serif;color:var(--text);background:var(--bg)}

    .wrap{max-width:1200px;margin:0 auto;padding:16px 16px 96px}
    h1{margin:8px 0 12px}
    .caption{font-size:13px;color:var(--muted);margin-bottom:12px}

    /* 카드 그리드 — 밈보다 큼 */
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
    @media (min-width:680px){ .grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
    @media (min-width:1024px){ .grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
    @media (min-width:1280px){ .grid{grid-template-columns:repeat(5,minmax(0,1fr));} }

    .card{display:block;border:1px solid var(--border);border-radius:16px;background:#fff;text-decoration:none;color:inherit;overflow:hidden}
    .thumb{aspect-ratio:4/3;background:#f3f4f6 center/cover no-repeat}
    .card-body{padding:12px}
    .card-title{font-weight:800;line-height:1.35}
    .card-meta{margin-top:6px;font-size:12px;color:var(--muted)}

    /* 하단 탭 */
    .tabs{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);display:grid;grid-template-columns:repeat(5,1fr);height:72px;z-index:40}
    .tab{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;font-size:12px;color:#333;text-decoration:none}
    .tab svg{width:22px;height:22px}
    .tab.active{color:var(--brand);font-weight:800}

    /* 모달(멀티 이미지/영상) */
    .backdrop{position:fixed;inset:0;background:rgba(17,19,24,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
    .backdrop.show{display:flex}

    .modal{width:min(1040px,100%);max-height:calc(100vh - 120px);background:#000;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden;display:grid;grid-template-rows:auto 1fr auto auto}
    .modal-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:#fff;border-bottom:1px solid var(--border)}
    .modal-title{font-weight:900}

    .viewer{position:relative;background:#000;display:grid;place-items:center}
    .viewer img,.viewer iframe{max-width:100%;max-height:calc(100vh - 300px);object-fit:contain;background:#000}

    .nav-btn{position:absolute;top:50%;transform:translateY(-50%);border:none;background:rgba(255,255,255,.85);width:42px;height:42px;border-radius:50%;display:grid;place-items:center;cursor:pointer}
    .nav-btn:hover{background:#fff}
    .nav-prev{left:10px}
    .nav-next{right:10px}

    .thumbstrip{display:flex;gap:8px;overflow:auto;padding:8px 12px;background:#0b0b0b;border-top:1px solid rgba(255,255,255,.08)}
    .thumbstrip img{width:72px;height:54px;object-fit:cover;border:2px solid transparent;border-radius:6px;cursor:pointer;opacity:.8}
    .thumbstrip img.active{border-color:var(--brand);opacity:1}

    .modal-footer{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:10px 12px;background:#fff;border-top:1px solid var(--border)}
    .counter{font-size:13px;color:var(--muted)}
    .desc{font-size:14px;line-height:1.6}

    .close-x{border:none;background:transparent;cursor:pointer}
    .close-x svg{width:22px;height:22px}

    .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>레퍼런스</h1>
    <div class="caption">클릭 시 다중 이미지/영상 팝업(캐러셀)로 열립니다. 카드 크기는 ‘밈’보다 크게 구성.</div>

    <div id="refGrid" class="grid">
      <!-- 예시 1: 이미지 단일 -->
      <a class="card" href="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme01.png"
         data-title="샘플 — 단일 이미지"
         data-text="<strong>단일 이미지</strong> 예시 설명입니다."
         data-images="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme01.png">
        <div class="thumb" style="background-image:url('https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme01.png')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 단일 이미지</div>
          <div class="card-meta">Image</div>
        </div>
      </a>

      <!-- 예시 2: 이미지 여러 장 -->
      <a class="card" href="#"
         data-title="샘플 — 다중 이미지"
         data-text="<strong>다중 이미지</strong> 캐러셀 예시."
         data-images="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme02.png, https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme03.jpg, https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme04.jpg">
        <div class="thumb" style="background-image:url('https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme02.png')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 다중 이미지</div>
          <div class="card-meta">Image × 3</div>
        </div>
      </a>

      <!-- 예시 3: 영상 단일 (유튜브 URL, t=초 지원) -->
      <a class="card" href="https://www.youtube.com/watch?v=Dz_EkjVNWFU&t=55s"
         data-title="샘플 — 단일 영상"
         data-text="<strong>단일 영상</strong> 예시. 유튜브 타임스탬프 지원."
         data-videos="https://www.youtube.com/watch?v=Dz_EkjVNWFU&t=55s">
        <div class="thumb" style="background-image:url('https://img.youtube.com/vi/Dz_EkjVNWFU/hqdefault.jpg')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 단일 영상</div>
          <div class="card-meta">YouTube</div>
        </div>
      </a>

      <!-- 예시 4: 이미지 + 영상 혼합 -->
      <a class="card" href="#"
         data-title="샘플 — 혼합 슬라이드"
         data-text="이미지와 영상이 섞인 캐러셀. ←/→, 스와이프, 썸네일, ESC 지원."
         data-images="https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme05.png, https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme04.jpg"
         data-videos="https://www.youtube.com/watch?v=_SPY2rXmCLg, https://youtu.be/94Ue8_RqOoM?t=614">
        <div class="thumb" style="background-image:url('https://raw.githubusercontent.com/eyoma-41/mysteryvlog/main/img/meme05.png')"></div>
        <div class="card-body">
          <div class="card-title">샘플 — 혼합 슬라이드</div>
          <div class="card-meta">Image × 2 · Video × 2</div>
        </div>
      </a>

      <!-- 필요 카드 계속 추가… data-images / data-videos 에 쉼표로 여러 URL 기입 -->
    </div>
  </div>

  <!-- 하단 탭 -->
  <nav class="tabs" aria-label="하단 메뉴">
    <a class="tab" href="index.html">
      <svg viewBox="0 0 24 24"><path d="M4 12.5a1 1 0 0 1 .4-.8l7-5a1 1 0 0 1 1.2 0l7 5a1 1 0 0 1 .4.8V19a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-6.5Z" fill="currentColor"/></svg>
      대시보드
    </a>
    <a class="tab" href="meme.html">
      <svg viewBox="0 0 24 24"><path d="M3 7h18M7 3v18M3 12h18M3 17h12" stroke="currentColor" stroke-width="2" fill="none"/></svg>
      밈
    </a>
    <a class="tab active" href="reference.html" aria-current="page">
      <svg viewBox="0 0 24 24"><path d="M5 4h14v16H5zM8 8h8M8 12h8M8 16h8" stroke="currentColor" stroke-width="2" fill="none"/></svg>
      레퍼런스
    </a>
    <a class="tab" href="behind.html">
      <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" fill="none"/></svg>
      비하인드
    </a>
    <a class="tab" href="revenue.html">
      <svg viewBox="0 0 24 24"><path d="M4 18s3-6 8-6 8 6 8 6M10 9a2 2 0 1 0 4 0 2 2 0 0 0-4 0Z" stroke="currentColor" stroke-width="2" fill="none"/></svg>
      수익창출
    </a>
  </nav>

  <!-- 멀티미디어 모달 -->
  <div id="backdrop" class="backdrop" aria-hidden="true">
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div id="modalTitle" class="modal-title">제목</div>
        <button class="close-x" id="closeX" aria-label="닫기">
          <svg viewBox="0 0 24 24"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        </button>
      </div>

      <div class="viewer">
        <button class="nav-btn nav-prev" id="btnPrev" aria-label="이전">
          <svg viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        </button>
        <!-- 동적으로 img 또는 iframe 채움 -->
        <div id="viewerSlot"></div>
        <button class="nav-btn nav-next" id="btnNext" aria-label="다음">
          <svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" fill="none"/></svg>
        </button>
      </div>

      <div class="thumbstrip" id="thumbstrip" aria-label="썸네일"></div>

      <div class="modal-footer">
        <div class="counter" id="counter">1 / 1</div>
        <div class="desc" id="modalDesc"></div>
      </div>
    </div>
  </div>

  <script>
    const grid = document.getElementById('refGrid');
    const backdrop = document.getElementById('backdrop');
    const modal = document.getElementById('modal');
    const viewerSlot = document.getElementById('viewerSlot');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const counter = document.getElementById('counter');
    const thumbstrip = document.getElementById('thumbstrip');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const closeX = document.getElementById('closeX');

    let slides = []; // {type:'image'|'youtube', src:'', thumb:''}
    let idx = 0;
    let keyListenerBound = false;
    let currentIframe = null;

    function toYouTubeEmbed(url){
      try{
        const u = new URL(url);
        let start = '';
        if (u.searchParams.has('t')) {
          const t = u.searchParams.get('t').replace('s','');
          start = `?start=${parseInt(t)}`;
        }
        if (u.hostname.includes('youtube.com')) {
          const v = u.searchParams.get('v');
          if (v) return {embed:`https://www.youtube.com/embed/${v}${start}`, id:v};
        }
        if (u.hostname.includes('youtu.be')) {
          const id = u.pathname.slice(1);
          if (id) return {embed:`https://www.youtube.com/embed/${id}${start}`, id};
        }
      } catch(e){}
      return null;
    }

    function parseList(attr){
      return (attr||'').split(',').map(s=>s.trim()).filter(Boolean);
    }

    function parseSlides(a){
      const imgs = parseList(a.dataset.images);
      const vids = parseList(a.dataset.videos);
      const arr = [];
      imgs.forEach(src=> arr.push({type:'image', src, thumb:src}));
      vids.forEach(url=>{
        const yt = toYouTubeEmbed(url);
        if(yt){
          arr.push({type:'youtube', src:yt.embed, thumb:`https://img.youtube.com/vi/${yt.id}/hqdefault.jpg`});
        }
      });
      if(arr.length===0){
        // 폴백: href가 이미지면 이미지로
        const href = a.getAttribute('href');
        if(/\.(png|jpe?g|webp|gif|bmp|avif)(\?.*)?$/i.test(href||'')){
          arr.push({type:'image', src:href, thumb:href});
        }
      }
      return arr;
    }

    function mount(type, src, title){
      viewerSlot.innerHTML='';
      currentIframe = null;
      if(type==='image'){
        const img = document.createElement('img');
        img.alt = title || '이미지';
        img.loading = 'eager';
        img.src = src;
        viewerSlot.appendChild(img);
      } else if(type==='youtube'){
        const iframe = document.createElement('iframe');
        iframe.className = 'video-preview';
        iframe.src = src;
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
        iframe.referrerPolicy = 'strict-origin-when-cross-origin';
        iframe.allowFullscreen = true;
        viewerSlot.appendChild(iframe);
        currentIframe = iframe;
      }
    }

    function show(i){
      if(!slides.length) return;
      idx = (i + slides.length) % slides.length;
      const s = slides[idx];
      mount(s.type, s.src, modalTitle.textContent);
      counter.textContent = `${idx+1} / ${slides.length}`;
      [...thumbstrip.querySelectorAll('img')].forEach((el, n)=> el.classList.toggle('active', n===idx));
      // 이웃 프리로드 (이미지에 한해)
      ['next','prev'].forEach((dir)=>{
        const j = dir==='next' ? (idx+1)%slides.length : (idx-1+slides.length)%slides.length;
        const sj = slides[j];
        if(sj.type==='image') { const im = new Image(); im.src = sj.src; }
      });
    }

    function buildThumbs(){
      thumbstrip.innerHTML = '';
      slides.forEach((s, n)=>{
        const t = document.createElement('img');
        t.src = s.thumb; t.alt = `썸네일 ${n+1}`; t.loading='lazy';
        t.addEventListener('click', (e)=>{ e.stopPropagation(); show(n); });
        thumbstrip.appendChild(t);
      });
    }

    function openModal(a){
      slides = parseSlides(a);
      modalTitle.textContent = a.dataset.title || a.querySelector('.card-title')?.textContent || '';
      modalDesc.innerHTML = a.dataset.text || '';
      buildThumbs();
      show(0);
      backdrop.classList.add('show');
      backdrop.setAttribute('aria-hidden','false');
      if(!keyListenerBound){
        document.addEventListener('keydown', onKey);
        keyListenerBound = true;
      }
    }

    function closeModal(){
      backdrop.classList.remove('show');
      backdrop.setAttribute('aria-hidden','true');
      // 비디오 정지
      if(currentIframe){ currentIframe.src='about:blank'; currentIframe=null; }
    }

    function onKey(e){
      if(backdrop.classList.contains('show')){
        if(e.key==='Escape') closeModal();
        else if(e.key==='ArrowRight') show(idx+1);
        else if(e.key==='ArrowLeft') show(idx-1);
      }
    }

    // 스와이프 제스처
    let touchX=null;
    viewerSlot.addEventListener('touchstart', e=>{ touchX = e.touches[0].clientX; }, {passive:true});
    viewerSlot.addEventListener('touchend', e=>{
      if(touchX==null) return;
      const dx = e.changedTouches[0].clientX - touchX;
      if(Math.abs(dx) > 40){ if(dx<0) show(idx+1); else show(idx-1); }
      touchX=null;
    }, {passive:true});

    grid.addEventListener('click', (e)=>{
      const a = e.target.closest('a.card');
      if(!a) return;
      e.preventDefault();
      openModal(a);
    });

    btnPrev.addEventListener('click', (e)=>{ e.stopPropagation(); show(idx-1); });
    btnNext.addEventListener('click', (e)=>{ e.stopPropagation(); show(idx+1); });
    closeX.addEventListener('click', (e)=>{ e.stopPropagation(); closeModal(); });
    backdrop.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=> e.stopPropagation());
  </script>
</body>
</html>
